{% extends 'base.html' %}

{% load static %}

{% block content %}
  <section class="mt-50 mb-50">
    <div class="container">
      <div class="row">
        <div class="col-12">
          <div class="row mb-50">
            <div class="col-lg-6 col-md-12">
              <div class="card">
                <div class="card-header">
                  <h5 class="mb-0">Payment Details</h5>
                </div>
                <div class="card-body contact-from-area">
                  <div class="row">
                    <div class="col-lg-12">
                      <form class="contact-form-style mt-30 mb-50" action="#" method="post">
                        <div class="input-style mb-20">
                          <label>Billing Address</label>
                          <div class="card-body">
                            <p>{{ order.first_name }} {{ order.last_name }}</p>
                            <p>{{ order.full_address }}</p>
                            <p>{{ order.city }},{{ order.state }}</p>
                            <p>{{ order.county }}</p>
                            <p>{{ order.email }}</p>
                            <p>{{ order.phone_number }}</p>
                            <a href="#" class="btn-small">Edit</a>
                          </div>
                        </div>
                        <div class="input-style mb-20">
                          <label>Payment Method</label>
                          <div class="card-body">
                            <div class="mb-4">
                              <label class="mb-2 form-check form-check-inline" style="width: 45%;">
                                <input class="form-check-input" checked="" name="mycategory" type="radio" />
                                <span class="form-check-label">Cash on delivery</span>
                              </label>
                            </div>
                            <div class="mb-4">
                              <label class="mb-2 form-check form-check-inline" style="width: 45%;">
                                <input class="form-check-input" name="mycategory" type="radio" />
                                <span class="form-check-label">PayPal</span>
                              </label>
                            </div>
                          </div>
                        </div>
                      </form>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-lg-6 col-md-12">
              <div class="border p-md-4 p-30 border-radius cart-totals">
                <div class="heading_s1 mb-3">
                  <h4>Cart Totals</h4>
                </div>
                <div class="table-responsive">
                  <table class="table">
                    <tbody>
                      <tr>
                        <td class="cart_total_label">Cart Subtotal</td>
                        <td class="cart_total_amount">
                          <span class="font-lg fw-900 text-brand">₹{{ total }}</span>
                        </td>
                      </tr>
                      <tr>
                        <td class="cart_total_label">Tax</td>
                        <td class="cart_total_amount">
                          <span class="font-lg fw-900 text-brand">₹{{ tax }}</span>
                        </td>
                      </tr>
                      <tr>
                        <td class="cart_total_label">Total</td>
                        <td class="cart_total_amount">
                          <strong><span class="font-xl fw-900 text-brand">₹{{ grand_total }}</span></strong>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>

                <div id="paypal-button-container">
                    
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
  <script>
    // Render the PayPal button into #paypal-button-container
    paypal
      .Buttons({
        style: {
          color: 'blue',
          shape: 'pill',
          label: 'pay',
          height: 40
        },
    
        // Call your server to set up the transaction
        createOrder: function (data, actions) {
          return fetch('/demo/checkout/api/paypal/order/create/', {
            method: 'post'
          })
            .then(function (res) {
              return res.json()
            })
            .then(function (orderData) {
              return orderData.id
            })
        },
    
        // Call your server to finalize the transaction
        onApprove: function (data, actions) {
          return fetch('/demo/checkout/api/paypal/order/' + data.orderID + '/capture/', {
            method: 'post'
          })
            .then(function (res) {
              return res.json()
            })
            .then(function (orderData) {
              // Three cases to handle:
              //   (1) Recoverable INSTRUMENT_DECLINED -> call actions.restart()
              //   (2) Other non-recoverable errors -> Show a failure message
              //   (3) Successful transaction -> Show confirmation or thank you
    
              // This example reads a v2/checkout/orders capture response, propagated from the server
              // You could use a different API or structure for your 'orderData'
              var errorDetail = Array.isArray(orderData.details) && orderData.details[0]
    
              if (errorDetail && errorDetail.issue === 'INSTRUMENT_DECLINED') {
                return actions.restart() // Recoverable state, per:
                // https://developer.paypal.com/docs/checkout/integration-features/funding-failure/
              }
    
              if (errorDetail) {
                var msg = 'Sorry, your transaction could not be processed.'
                if (errorDetail.description) msg += '\n\n' + errorDetail.description
                if (orderData.debug_id) msg += ' (' + orderData.debug_id + ')'
                return alert(msg) // Show a failure message (try to avoid alerts in production environments)
              }
    
              // Successful capture! For demo purposes:
              console.log('Capture result', orderData, JSON.stringify(orderData, null, 2))
              var transaction = orderData.purchase_units[0].payments.captures[0]
              alert('Transaction ' + transaction.status + ': ' + transaction.id + '\n\nSee console for all available details')
    
              // Replace the above to show a success message within this page, e.g.
              // const element = document.getElementById('paypal-button-container');
              // element.innerHTML = '';
              // element.innerHTML = '<h3>Thank you for your payment!</h3>';
              // Or go to another URL:  actions.redirect('thank_you.html');
            })
        }
      })
      .render('#paypal-button-container')
  </script>
{% endblock %}
